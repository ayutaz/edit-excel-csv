# プロダクト/UX/デザイン分析レポート

## 概要

Excel/CSVブラウザ編集Webアプリのプロダクト設計、UX方針、デザイン分析をまとめる。

---

## 1. ペルソナ定義

### ペルソナA: 事務職 田中さん (35歳)

- **職業**: 中小企業の経理担当
- **課題**: 会社PCにExcelが入っていない。取引先から送られるExcelファイルを確認・修正したい
- **ニーズ**: インストール不要で手軽にExcelを開きたい。データは社外に出したくない
- **技術レベル**: 基本的なPC操作可能。コマンドライン不可
- **利用シーン**: ブラウザでURLを開く → ファイルをドラッグ&ドロップ → 編集 → ダウンロード

### ペルソナB: エンジニア 佐藤さん (28歳)

- **職業**: Webエンジニア
- **課題**: CSVデータの中身を素早く確認・修正したい。Excelを開くのは重い
- **ニーズ**: 軽量で速い。プライバシーが確保されている。OSSであること
- **技術レベル**: 高い。GitHub利用者
- **利用シーン**: CSV/Excelのちょっとした確認・編集に日常的に使用

### ペルソナC: 学生 山田さん (20歳)

- **職業**: 大学生
- **課題**: レポート用のExcelファイルを編集したいがOfficeライセンスがない
- **ニーズ**: 無料で使えること。アカウント登録不要
- **技術レベル**: 一般的
- **利用シーン**: レポート作成時にExcelデータを編集

---

## 2. MVPスコープ

### 含めるもの (Must Have)

- [x] xlsx/xls/csvファイルの読み込み・表示
- [x] セルの直接編集（値の入力・変更）
- [x] xlsx/csv形式でのファイル保存
- [x] ドラッグ&ドロップでファイルアップロード
- [x] ファイル選択ダイアログでのアップロード
- [x] 未保存変更の警告（ブラウザ離脱時）
- [x] 日本語UI
- [x] Error Boundary（エラー時のフォールバックUI）
- [x] CSVインジェクション基本検出（エクスポート時のconsole警告のみ）
- [x] シングルファイルモード（同時に1ファイルのみ編集可能）

### 含めないもの (Phase 2以降)

- [ ] ダークモード
- [ ] キーボードショートカット（Ctrl+O, Ctrl+S）
- [ ] セルスタイル編集（フォント、色、罫線）
- [ ] レスポンシブデザイン（モバイル対応）
- [ ] PWA対応（オフライン動作）
- [ ] CSVインジェクション検出時のユーザーUI警告表示
- [ ] マルチファイル同時編集（タブ切替）
- [ ] WCAG 2.1 AA準拠アクセシビリティ
- [ ] i18n（英語対応）
- [ ] リアルタイム共同編集
- [ ] マクロ/VBA実行
- [ ] 印刷プレビュー

---

## 3. ロードマップ

```
MVP (2週間)
├── フェーズ0: プロジェクト基盤 (1-2日)
├── フェーズ1: Univer統合 (2-3日)
├── フェーズ2: ファイル読み込み (3-4日)
├── フェーズ3: ファイル書き出し (2-3日)
└── フェーズ4: アプリUI + 仕上げ (2-3日)

Phase 2 (2-4週間)
├── ダークモード切替
├── Excel互換キーボードショートカット
├── レスポンシブデザイン
├── CSVインジェクション検出
└── GitHub Actions CI

Phase 3 (4-8週間)
├── PWA対応
├── アクセシビリティ (WCAG 2.1 AA)
├── i18n（英語対応）
├── セルスタイル編集
└── Web Worker化（大規模ファイル対応）
```

---

## 4. UXフロー設計

### メインフロー: ファイルを開いて編集して保存

```
[ランディング]
  ├── 「ファイルを開く」ボタンクリック → ファイル選択ダイアログ
  ├── ファイルをドラッグ&ドロップ
  └── 「新規作成」ボタンクリック → 空のシート
       （デフォルト: 1シート「Sheet1」、100行×26列(A-Z)、ファイル名: 無題.xlsx）
         ↓
[ファイル読み込み中] ← ローディングインジケーター表示
         ↓
[スプレッドシート表示]
  ├── セルをクリック → 編集モード
  ├── シートタブ切替（複数シート対応）
  └── ツールバー操作
         ↓
[保存] ← 「名前を付けて保存」ダイアログ
  ├── xlsx形式で保存
  └── csv形式で保存
         ↓
[ダウンロード完了通知]
```

### シート管理UI

UniverのシートタブUIを活用し、以下のシート操作を提供する。

```
[スプレッドシート表示]
├── シートタブ
│   ├── タブクリック → シート切替
│   ├── タブダブルクリック → シート名変更（インライン編集）
│   ├── タブ右クリック → コンテキストメニュー
│   │   ├── 「名前の変更」
│   │   ├── 「シートを追加」
│   │   └── 「シートを削除」（確認ダイアログ表示）
│   └── 「+」ボタン → 新しいシートを末尾に追加
└── デフォルトシート名: 「Sheet1」「Sheet2」...
```

**制約 (MVP)**: シートの並び替え（ドラッグ&ドロップ）はPhase 2で対応。

### エラーフロー

```
[ファイル読み込みエラー]
  ├── 非対応形式 → 「対応形式: xlsx, xls, csv」メッセージ
  ├── サイズ超過 → 「ファイルサイズが上限(50MB)を超えています」メッセージ
  ├── 破損ファイル → 「ファイルの読み込みに失敗しました」メッセージ
  └── すべてのエラーで「再試行」ボタン表示
```

---

## 5. アクセシビリティ方針

### MVP段階

- キーボードでの基本操作（Tab移動、Enter確定、Escape キャンセル）
- フォーカスの視覚的表示
- 適切なコントラスト比（WCAG AA: 4.5:1以上）
- セマンティックHTML（`<button>`, `<dialog>`, `<nav>` 等）

### Phase 2以降 (WCAG 2.1 AA準拠)

- スクリーンリーダー対応（`aria-label`, `aria-live` 等）
- Canvas内セルのアクセシビリティ補助（ARIA grid pattern）
- 高コントラストモード
- テキストサイズ200%拡大対応

---

## 6. UIコンポーネント選定

### shadcn/ui 採用理由

| 観点 | shadcn/ui | MUI | Ant Design |
|---|---|---|---|
| バンドルサイズ | 極小（必要分のみコピー） | 大 | 大 |
| カスタマイズ性 | 最高（ソースコード直接編集） | CSS-in-JS依存 | テーマ変数 |
| Tailwind親和性 | ネイティブ | 低い | 低い |
| ライセンス | MIT | MIT | MIT |
| 学習コスト | 低 | 中 | 中 |

### 使用するshadcn/uiコンポーネント

- **Button**: ファイル操作ボタン
- **Dialog**: ファイルオープン/セーブダイアログ
- **DropdownMenu**: ファイルメニュー
- **Toast**: 通知メッセージ
- **Tooltip**: ツールバーアイコンのヒント
- **Separator**: ツールバー区切り
- **Sheet**: モバイルメニュー（Phase 2）

---

## 7. カラースキーム

### ライトモード（MVP）

```css
--background: #FFFFFF;
--foreground: #0F172A;        /* Slate 900 */
--primary: #2563EB;           /* Blue 600 */
--primary-foreground: #FFFFFF;
--secondary: #F1F5F9;         /* Slate 100 */
--muted: #F8FAFC;             /* Slate 50 */
--border: #E2E8F0;            /* Slate 200 */
--destructive: #EF4444;       /* Red 500 */
--accent: #F1F5F9;            /* Slate 100 */
```

### ダークモード（Phase 2）

```css
--background: #0F172A;        /* Slate 900 */
--foreground: #F8FAFC;        /* Slate 50 */
--primary: #3B82F6;           /* Blue 500 */
--primary-foreground: #FFFFFF;
--secondary: #1E293B;         /* Slate 800 */
--muted: #1E293B;             /* Slate 800 */
--border: #334155;            /* Slate 700 */
--destructive: #F87171;       /* Red 400 */
--accent: #1E293B;            /* Slate 800 */
```

---

## 8. レイアウト設計

### デスクトップレイアウト (MVP)

```
┌────────────────────────────────────────────────┐
│  Header                                         │
│  [ロゴ] [ファイル名]           [開く] [保存]    │
├────────────────────────────────────────────────┤
│  Toolbar (Phase 2: 書式ツールバー)              │
├────────────────────────────────────────────────┤
│                                                  │
│                                                  │
│              Univer Spreadsheet                  │
│              (Canvas描画エリア)                   │
│                                                  │
│                                                  │
│                                                  │
├────────────────────────────────────────────────┤
│  StatusBar [シート情報] [選択セル情報]           │
└────────────────────────────────────────────────┘
```

### ランディング画面（ファイル未読み込み時）

```
┌────────────────────────────────────────────────┐
│  Header                                         │
├────────────────────────────────────────────────┤
│                                                  │
│         ┌──────────────────────────┐           │
│         │                          │           │
│         │  📄 ファイルをドロップ    │           │
│         │  またはクリックして選択   │           │
│         │                          │           │
│         │  対応形式:               │           │
│         │  .xlsx .xls .csv         │           │
│         │  ※ .odsはPhase 2対応予定 │           │
│         │                          │           │
│         └──────────────────────────┘           │
│                                                  │
│         [新規スプレッドシートを作成]             │
│                                                  │
└────────────────────────────────────────────────┘
```

---

## 結論

MVP段階では「ファイルを開く → 編集 → 保存」の基本フローに集中し、直感的で迷わないUIを目指す。shadcn/ui + Tailwind CSSにより軽量かつカスタマイズ性の高いUIを構築し、Phase 2以降でダークモード、レスポンシブ、アクセシビリティを段階的に強化する。
